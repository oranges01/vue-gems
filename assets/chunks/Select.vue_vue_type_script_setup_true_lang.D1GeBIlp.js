import{d as W,N as q,s as h,a6 as z,v as $,h as b,o as u,c,I as p,w as y,e as G,j as J,F as Q,E as T,n as V,$ as f,k as F,b as B}from"./framework.Du1KEPtK.js";import{d as X,_ as Y}from"./Tooltip.vue_vue_type_script_setup_true_lang.DZl5Xp1t.js";import{_ as Z}from"./Input.vue_vue_type_script_setup_true_lang.AYX7f_Ea.js";import{_ as x,i as D}from"./Icon.vue_vue_type_script_setup_true_lang.DhRIcCO1.js";import{R as ee}from"./RenderVnode.BxXTBYmB.js";import{a as te}from"./types.Dnj8X3EN.js";const le={key:0,class:"gems-select__loading"},ne={key:1,class:"gems-select__nodata"},ae={class:"gems-select__menu"},oe=["id","onClick"],pe=W({name:"GemsSelect",__name:"Select",props:{modelValue:null,options:{default:()=>[]},placeholder:null,disabled:{type:Boolean},clearable:{type:Boolean},renderLabel:{type:Function},filterable:{type:Boolean},filterMethod:{type:Function},remote:{type:Boolean},remoteMethod:{type:Function}},emits:["change","update:modelValue","visible-change","clear"],setup(r,{emit:S}){const I=q(te,null),g=t=>{I&&I.validate(t).catch(n=>console.log(n.errors))},l=r,s=S,k=t=>l.options.find(n=>n.value===t)||null,m=h(),O=h(),v=k(l.modelValue),e=z({inputValue:v?v.label:"",selectedOption:v,mouseHover:!1,loading:!1,hightlightIndex:-1});$(()=>l.modelValue,async t=>{const n=k(t);e.inputValue=n?n.label:"",e.selectedOption=n;const a=n?n.value:"";s("change",a),s("update:modelValue",a),g("change")});const R={modifiers:[{name:"offset",options:{offset:[0,9]}},{name:"sameWidth",enabled:!0,fn:({state:t})=>{t.styles.popper.width=`${t.rects.reference.width}px`},phase:"beforeWrite",requires:["computeStyles"]}]},o=h(l.options);$(()=>l.options,t=>{o.value=t});const w=async t=>{if(l.filterable){if(l.filterMethod&&D(l.filterMethod))o.value=l.filterMethod(t);else if(l.remote&&l.remoteMethod&&D(l.remoteMethod))try{e.loading=!0,o.value=await l.remoteMethod(t)}catch(n){console.error(n),o.value=[]}finally{e.loading=!1}else o.value=l.options.filter(n=>n.label.includes(t.toString()));e.hightlightIndex=-1}},N=b(()=>l.filterable&&e.selectedOption&&i.value?e.selectedOption.label:l.placeholder),E=()=>{w(e.inputValue)},H=b(()=>l.remote?300:0),L=X(E,H.value),K=b(()=>l.clearable&&e.mouseHover&&e.inputValue!=null&&e.inputValue.toString().trim()!==""&&e.selectedOption),j=()=>{e.selectedOption=null,e.inputValue="",s("clear"),s("change",""),g("change"),s("update:modelValue","")},A=()=>{},i=h(!1),d=t=>{t?(l.filterable&&e.selectedOption&&(e.inputValue=""),l.filterable&&w(e.inputValue),m.value.show()):(l.filterable&&(e.inputValue=e.selectedOption?e.selectedOption.label:""),m.value.hide(),e.hightlightIndex=-1),i.value=t,s("visible-change",t)},P=()=>{l.disabled||(i.value?d(!1):d(!0))},_=t=>{t.disabled||(e.inputValue=t.label,e.selectedOption=t,s("change",t.value),g("change"),s("update:modelValue",t.value),d(!1),O.value.ref.focus())},U=t=>{switch(t.key){case"Enter":i.value?e.hightlightIndex!==-1&&o.value[e.hightlightIndex]?_(o.value[e.hightlightIndex]):d(!1):d(!0);break;case"Escape":i.value&&d(!1);break;case"ArrowUp":t.preventDefault(),i.value&&o.value.length>0&&(e.hightlightIndex===-1||e.hightlightIndex===0?e.hightlightIndex=o.value.length-1:e.hightlightIndex=e.hightlightIndex-1);break;case"ArrowDown":t.preventDefault(),i.value&&o.value.length>0&&(e.hightlightIndex===-1||e.hightlightIndex===o.value.length-1?e.hightlightIndex=0:e.hightlightIndex=e.hightlightIndex+1);break}};return(t,n)=>(u(),c("div",{class:V(["gems-select",{"is-disabled":r.disabled}]),onMouseenter:n[2]||(n[2]=a=>e.mouseHover=!0),onMouseleave:n[3]||(n[3]=a=>e.mouseHover=!1)},[p(Y,{placement:"bottom-start",manual:"","popper-options":R,ref_key:"tooltipRef",ref:m,onClickOutside:n[1]||(n[1]=a=>d(!1)),onClick:P},{content:y(()=>[e.loading?(u(),c("div",le,[p(x,{icon:"spinner",spinner:""})])):r.filterable&&o.value.length===0&&!e.loading?(u(),c("div",ne," no matching data ")):G("",!0),J("ul",ae,[(u(!0),c(Q,null,T(o.value,(a,C)=>{var M;return u(),c("li",{key:C,class:V(["gems-select__menu-item",{"is-disabled":a.disabled,"is-selected":a.value===((M=e.selectedOption)==null?void 0:M.value),"is-highlighted":C===e.hightlightIndex}]),id:`select-item-${a.value}`,onClick:f(ie=>_(a),["stop"])},[p(F(ee),{vnode:r.renderLabel?r.renderLabel(a):a.label},null,8,["vnode"])],10,oe)}),128))])]),default:y(()=>[p(Z,{modelValue:e.inputValue,"onUpdate:modelValue":n[0]||(n[0]=a=>e.inputValue=a),disabled:r.disabled,placeholder:N.value,ref_key:"inputRef",ref:O,readonly:!r.filterable||!i.value,onInput:F(L),onKeydown:f(U,["stop"])},{suffix:y(()=>[K.value?(u(),B(x,{key:0,icon:"circle-xmark",onMousedown:f(A,["prevent"]),onClick:f(j,["stop"]),class:"gems-input__clear"})):(u(),B(x,{key:1,icon:"angle-down",class:V(["header-icon",{"is-active":i.value}])},null,8,["class"]))]),_:1},8,["modelValue","disabled","placeholder","readonly","onInput"])]),_:1},512)],34))}});export{pe as _};
